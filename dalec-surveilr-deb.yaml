# syntax=ghcr.io/azure/dalec/frontend:latest
# DALEC config for packaging existing surveilr binary

name: surveilr
version: 3.1.0
revision: 1
packager: Surveilr Team
vendor: Surveilr
license: GPL-3.0
description: Resource surveillance and monitoring tool
website: https://surveilr.com

sources:
  src:
    context: {}

# Add build and runtime dependencies for ODBC
dependencies:
  build:
    unixodbc-dev:
    libodbc1:
  runtime:
    libodbc1:
    unixodbc:

# No compilation - just package existing binary from build context  
build:
  steps:
    - command: |
        set -ex
        
        # Install ODBC dependencies in build environment
        apt-get update
        apt-get install -y unixodbc-dev libodbc1
        
        # Debug: Check what files are available
        pwd
        ls -la
        find . -name "*surveilr*" -type f
        
        # Binary provided by repository dispatch workflow
        # Should be available in build context from src/ directory
        ls -la src/surveilr
        cp src/surveilr ./surveilr
        chmod +x surveilr

artifacts:
  binaries:
    surveilr:

targets:
  jammy:          # Ubuntu 22.04 DEB
  bookworm:       # Debian 12 DEB